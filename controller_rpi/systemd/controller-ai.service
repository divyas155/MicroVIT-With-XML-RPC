[Unit]
Description=Controller AI Service (Raspberry Pi)
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/MicroVIT/controller_rpi/src
Environment="OLLAMA_NO_GPU=1"
ExecStartPre=/bin/bash -c 'curl -sf http://localhost:11434/api/tags >/dev/null || { OLLAMA_NO_GPU=1 nohup ollama serve >/dev/null 2>&1 & for i in $(seq 1 24); do sleep 5; curl -sf http://localhost:11434/api/tags >/dev/null && break; done; }; sleep 2'
ExecStart=/bin/bash -c 'source /home/pi/MicroVIT/controller_rpi/venv/bin/activate && python3 controller_ai_service.py'
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
